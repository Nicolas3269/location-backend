{% extends "base/pdf_base.html" %}

{% block title %}Devis MRH - {{ quotation.id|slice:":8" }}{% endblock %}

{% block extra_css %}
{% include "pdf/assurances/mrh/components/_css_common.html" %}

/* ===== Validité (spécifique devis) ===== */
.validity-banner {
    background-color: #f0f9f4;
    border: 1px solid #479965;
    border-left: 4px solid #479965;
    border-radius: 4px;
    padding: 12px 20px;
    margin: 20px 0;
}

.validity-banner p {
    margin: 0;
    color: #2d6b42;
    font-size: 10pt;
}

/* ===== Formules cards (spécifique devis) ===== */
.formulas-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px 0;
}

.formula-card {
    border: 2px solid var(--hestia-border);
    border-radius: 8px;
    padding: 20px;
    background: white;
}

.formula-card.serenite {
    border-color: #f2c94c;
    background: linear-gradient(135deg, #fffef5 0%, #fff8e6 100%);
}

.formula-name {
    font-size: 14pt;
    font-weight: 700;
    color: var(--hestia-primary);
    margin: 0 0 5px 0;
}

.formula-card.serenite .formula-name {
    color: #b8860b;
}

.formula-desc {
    font-size: 9pt;
    color: var(--hestia-text-light);
    margin-bottom: 15px;
}

.formula-price {
    font-size: 20pt;
    font-weight: 700;
    color: var(--hestia-primary);
    text-align: center;
    padding: 15px;
    background-color: rgba(38, 128, 235, 0.1);
    border-radius: 6px;
    margin: 10px 0;
}

.formula-card.serenite .formula-price {
    background-color: rgba(242, 201, 76, 0.2);
    color: #b8860b;
}

.formula-price-monthly {
    font-size: 10pt;
    font-weight: 400;
    color: var(--hestia-text-light);
}

.formula-features {
    list-style: none;
    padding: 0;
    margin: 15px 0 0 0;
}

.formula-features li {
    padding: 5px 0;
    font-size: 9pt;
    color: var(--hestia-text);
}

.formula-features li::before {
    content: "✓ ";
    color: #479965;
    font-weight: bold;
}

/* ===== Legal notice (spécifique devis) ===== */
.legal-notice {
    background-color: #f5f7f9;
    border-radius: 6px;
    padding: 15px;
    margin: 20px 0;
    font-size: 8pt;
    color: var(--hestia-text-light);
}

.legal-notice p {
    margin: 5px 0;
    text-align: justify;
}
{% endblock %}

{% block content %}
<!-- ===== EN-TÊTE DOCUMENT ===== -->
<div class="document-header">
    <h1>Assurance Multirisque Habitation Locataire</h1>
    <div class="subtitle">Devis</div>
    <div class="reference-badge">Devis n° {{ quotation.id|slice:":8"|upper }}</div>
</div>

<!-- ===== VALIDITÉ ===== -->
<div class="validity-banner">
    <p><strong>Ce devis est valable 2 mois</strong> à compter de la date d'émission ({{ quotation.created_at|date:"d/m/Y" }}).</p>
</div>

<!-- ===== PARTIES AU CONTRAT ===== -->
<div class="parties-grid">
    <div class="partie-section">
        <h3>Souscripteur</h3>
        <div class="partie-row">
            <span class="partie-label">Nom :</span>
            <span class="partie-value">{{ subscriber.first_name }} {{ subscriber.last_name }}</span>
        </div>
        <div class="partie-row">
            <span class="partie-label">Adresse :</span>
            <span class="partie-value">
                {% if adresse %}
                    {{ adresse }}
                {% else %}
                    -
                {% endif %}
            </span>
        </div>
    </div>

    <div class="partie-section">
        <h3>Votre Distributeur</h3>
        <div class="partie-row">
            <span class="partie-label">Nom :</span>
            <span class="partie-value">Hestia (HB CONSULTING)</span>
        </div>
        <div class="partie-row">
            <span class="partie-label">Adresse :</span>
            <span class="partie-value">25 Rue Saint Michel, 62000 ARRAS</span>
        </div>
        <div class="partie-row">
            <span class="partie-label">N° ORIAS :</span>
            <span class="partie-value">25009004</span>
        </div>
    </div>
</div>

<!-- ===== VOTRE SITUATION ===== -->
<div class="section-box">
    <div class="section-header">Votre Situation</div>
    <div class="section-content">
        <div class="contrat-grid">
            <!-- Colonne gauche : RISQUE DÉCLARÉ -->
            <div class="contrat-col">
                <h4>Risque Déclaré</h4>
                <div class="contrat-row">
                    <span class="contrat-label">Adresse :</span>
                    <span class="contrat-value">
                        {% if adresse %}
                            {{ adresse.rue }}{% if adresse.complement %}, {{ adresse.complement }}{% endif %}<br>
                            {{ adresse.code_postal }} {{ adresse.ville }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                <p class="typologie-text" style="margin-top: 15px;">
                    Logement à usage d'habitation principale et ses dépendances dont la surface est de
                    50 m² maximum (cave, parking et garage).
                </p>
            </div>

            <!-- Colonne droite : DÉTAILS -->
            <div class="contrat-col">
                <h4>&nbsp;</h4>
                <div class="contrat-row">
                    <span class="contrat-label">Nombre de pièces :</span>
                    <span class="contrat-value">
                        {% if bien and bien.nombre_pieces_principales %}
                            {{ bien.nombre_pieces_principales }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Appartement/Maison :</span>
                    <span class="contrat-value">
                        {% if bien %}
                            {{ bien.type_bien|title }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Étage :</span>
                    <span class="contrat-value">
                        {% if bien and bien.etage is not None %}
                            {% if bien.etage == 0 %}Rez-de-chaussée{% else %}{{ bien.etage }}{% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Franchise souhaitée :</span>
                    <span class="contrat-value">{{ deductible }} €</span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Date d'effet souhaitée :</span>
                    <span class="contrat-value">{{ effective_date|date:"d/m/Y" }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ===== NOTRE PROPOSITION ===== -->
<div class="section-box">
    <div class="section-header">Notre Proposition*</div>
    <div class="section-content">
        <div class="formulas-grid">
            {% for formula in formulas %}
            <div class="formula-card {% if formula.code == 'MRHIND_SER' %}serenite{% endif %}">
                <h3 class="formula-name">{{ formula.label }}</h3>
                <p class="formula-desc">{{ formula.description }}</p>

                <div class="formula-price">
                    {{ formula.pricing_annual|floatformat:2 }} € TTC<br>
                    <span class="formula-price-monthly">soit {{ formula.pricing_monthly|floatformat:2 }} € par mois</span>
                </div>

                <ul class="formula-features">
                    {% for feature in formula.features %}
                    <li>{{ feature }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endfor %}
        </div>

        <div class="cotisation-info" style="margin-top: 15px;">
            <p>Le tarif annuel TTC hors taxe attentat inclut :</p>
            <p>• 85 % de cotisations d'assurance TTC,</p>
            <p>• 15 % de frais de services de Mila Services.</p>
            <p style="margin-top: 12px;">La taxe attentat de 6,50 € est payable annuellement.</p>
        </div>
    </div>
</div>

<p style="font-size: 8pt; color: var(--hestia-text-light); margin-top: 5px;">
    *Le montant de la cotisation d'assurance est susceptible de varier en fonction des taxes fiscales et contributions obligatoires applicables à la date d'effet du contrat.
</p>

<!-- ===== FORMULE ET GARANTIES DEMANDÉES ===== -->
<div class="text-section">
    <h3>Formule et Garanties Demandées</h3>
    <p>
        Le contrat couvre les garanties telles que présentées dans les conditions générales CG-MRH-I-2024061
        valant notice d'information, dans la limite contractuelle de 3 000 000 € par sinistre, tous postes
        de préjudice confondus (dont mobilier).
    </p>
</div>

<!-- ===== TABLEAU DES GARANTIES ===== -->
{% include "pdf/assurances/mrh/components/_tableau_garanties.html" %}

<!-- ===== PRINCIPALES EXCLUSIONS ===== -->
{% include "pdf/assurances/mrh/components/_exclusions.html" %}

<!-- ===== MESURES DE PRÉVENTION ===== -->
{% include "pdf/assurances/mrh/components/_prevention.html" %}

<!-- ===== GESTIONNAIRE DU CONTRAT ===== -->
{% include "pdf/assurances/mrh/components/_gestionnaire.html" %}

<!-- ===== DOCUMENT NON CONTRACTUEL ===== -->
<div class="alert-box">
    <p><strong>Ce devis est un document non contractuel.</strong> Il est établi en fonction de vos déclarations. Les garanties s'entendent dans les limites et conditions du contrat au jour de la délivrance du présent devis.</p>
</div>

<!-- ===== PROTECTION DES DONNÉES ===== -->
{% with is_devis=True %}
{% include "pdf/assurances/mrh/components/_protection_donnees.html" %}
{% endwith %}

<!-- ===== RÉCLAMATIONS ===== -->
{% include "pdf/assurances/mrh/components/_reclamations.html" %}

<!-- ===== VALIDITÉ DU DEVIS ===== -->
<div class="footer-note" style="text-align: center; margin-top: 30px;">
    <p style="margin: 0 0 5px 0; font-size: 10pt; color: var(--hestia-text);">
        <strong>Devis émis le {{ quotation.created_at|date:"d/m/Y" }}</strong>
    </p>
    <p style="margin: 0; font-size: 9pt;">
        Devis valable deux mois à compter de la date d'émission.
    </p>
</div>
{% endblock %}
