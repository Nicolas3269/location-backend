{% extends "base/pdf_base.html" %}

{% block title %}Conditions Particulières - {{ policy.policy_number }}{% endblock %}

{% block extra_css %}
/* ===== Variables de couleurs Mila ===== */
:root {
    --mila-coral: #e07860;
    --mila-coral-light: #f5d5ce;
    --mila-text: #3e3c41;
    --mila-text-light: #6c6b70;
    --mila-border: #e3e5e8;
    --mila-bg: #fafbfc;
}

/* ===== En-tête parties ===== */
.parties-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-bottom: 25px;
}

.partie-section h3 {
    color: var(--mila-coral);
    font-size: 11pt;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin: 0 0 12px 0;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--mila-coral);
}

.partie-row {
    display: flex;
    margin-bottom: 6px;
    font-size: 10pt;
}

.partie-label {
    color: var(--mila-text-light);
    min-width: 80px;
}

.partie-value {
    color: var(--mila-text);
    font-weight: 500;
}

/* ===== Sections avec header coral ===== */
.section-box {
    border: 2px solid var(--mila-coral);
    border-radius: 8px;
    margin-bottom: 20px;
    overflow: hidden;
}

.section-header {
    background: var(--mila-coral);
    color: white;
    padding: 10px 15px;
    font-size: 12pt;
    font-weight: 600;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.section-content {
    padding: 20px;
    background: white;
}

/* ===== Contrat grid (2 colonnes) ===== */
.contrat-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.contrat-col h4 {
    color: var(--mila-coral);
    font-size: 10pt;
    font-weight: 600;
    text-transform: uppercase;
    margin: 0 0 12px 0;
}

.contrat-row {
    display: flex;
    margin-bottom: 8px;
    font-size: 9.5pt;
}

.contrat-label {
    color: var(--mila-text-light);
    min-width: 160px;
}

.contrat-value {
    color: var(--mila-text);
}

/* ===== Typologie ===== */
.typologie-section {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid var(--mila-border);
}

.typologie-section h4 {
    color: var(--mila-coral);
    font-size: 10pt;
    font-weight: 600;
    text-transform: uppercase;
    margin: 0 0 10px 0;
}

.typologie-text {
    font-size: 9.5pt;
    color: var(--mila-text);
    line-height: 1.5;
}

/* ===== Cotisation grid ===== */
.cotisation-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.tarif-section h4 {
    color: var(--mila-coral);
    font-size: 10pt;
    font-weight: 600;
    text-transform: uppercase;
    margin: 0 0 10px 0;
}

.tarif-amount {
    font-size: 18pt;
    font-weight: 700;
    color: var(--mila-coral);
    margin-bottom: 5px;
}

.tarif-detail {
    font-size: 9pt;
    color: var(--mila-text-light);
    margin-bottom: 3px;
}

.tarif-monthly {
    font-size: 11pt;
    font-weight: 600;
    color: var(--mila-coral);
    margin-top: 8px;
}

.cotisation-info {
    font-size: 9pt;
    color: var(--mila-text);
    line-height: 1.6;
}

.cotisation-info p {
    margin: 0 0 8px 0;
}

/* ===== Section texte simple ===== */
.text-section {
    margin-bottom: 20px;
}

.text-section h3 {
    color: var(--mila-coral);
    font-size: 11pt;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin: 0 0 10px 0;
}

.text-section p {
    font-size: 9.5pt;
    color: var(--mila-text);
    line-height: 1.6;
    margin: 0;
}

/* ===== Tableau garanties ===== */
.table-garanties {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
    font-size: 9pt;
}

.table-garanties th {
    background-color: var(--mila-coral);
    color: white;
    font-weight: 600;
    padding: 10px;
    text-align: left;
    border: 1px solid var(--mila-coral);
}

.table-garanties td {
    padding: 8px 10px;
    border: 1px solid var(--mila-border);
    color: var(--mila-text);
}

.table-garanties tr:nth-child(even) {
    background-color: var(--mila-bg);
}

.table-garanties .check {
    color: #479965;
    font-weight: bold;
    text-align: center;
}

.table-garanties .cross {
    color: #d96c63;
    text-align: center;
}

/* ===== Footer note ===== */
.footer-note {
    font-size: 8pt;
    color: var(--mila-text-light);
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid var(--mila-border);
}

/* ===== Signatures ===== */
.signature-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 30px;
}

.signature-box {
    border: 1px solid var(--mila-border);
    border-radius: 6px;
    padding: 15px;
    min-height: 100px;
}

.signature-box h4 {
    margin: 0 0 10px 0;
    color: var(--mila-text-light);
    font-size: 10pt;
}
{% endblock %}

{% block content %}
<!-- ===== PARTIES AU CONTRAT ===== -->
<div class="parties-grid">
    <div class="partie-section">
        <h3>Souscripteur</h3>
        <div class="partie-row">
            <span class="partie-label">Nom :</span>
            <span class="partie-value">{{ subscriber.first_name }} {{ subscriber.last_name }}</span>
        </div>
        <div class="partie-row">
            <span class="partie-label">Adresse :</span>
            <span class="partie-value">
                {% if locataire and locataire.adresse %}
                    {{ locataire.adresse.formatted_address }}
                {% elif adresse %}
                    {{ adresse.formatted_address }}
                {% else %}
                    -
                {% endif %}
            </span>
        </div>
    </div>

    <div class="partie-section">
        <h3>Votre Distributeur</h3>
        <div class="partie-row">
            <span class="partie-label">Nom :</span>
            <span class="partie-value">Hestia</span>
        </div>
        <div class="partie-row">
            <span class="partie-label">Adresse :</span>
            <span class="partie-value">-</span>
        </div>
        <div class="partie-row">
            <span class="partie-label">N° ORIAS :</span>
            <span class="partie-value">-</span>
        </div>
    </div>
</div>

<!-- ===== CONTRAT INDIVIDUEL ===== -->
<div class="section-box">
    <div class="section-header">Contrat Individuel</div>
    <div class="section-content">
        <div class="contrat-grid">
            <!-- Colonne gauche : VOTRE CONTRAT -->
            <div class="contrat-col">
                <h4>Votre Contrat</h4>
                <div class="contrat-row">
                    <span class="contrat-label">N° de contrat :</span>
                    <span class="contrat-value">{{ policy.policy_number }}</span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">N° conditions générales :</span>
                    <span class="contrat-value">CG-MRH-I-2024061</span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Date de prise d'effet :</span>
                    <span class="contrat-value">{{ quotation.effective_date|date:"d/m/Y" }}</span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Échéance principale :</span>
                    <span class="contrat-value">{{ quotation.effective_date|date:"d/m" }}</span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Fractionnement de paiement :</span>
                    <span class="contrat-value">Annuel</span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Durée :</span>
                    <span class="contrat-value">1 an renouvelable par tacite reconduction</span>
                </div>
            </div>

            <!-- Colonne droite : RISQUE GARANTI -->
            <div class="contrat-col">
                <h4>Risque Garanti</h4>
                <div class="contrat-row">
                    <span class="contrat-label">Adresse :</span>
                    <span class="contrat-value">
                        {% if adresse %}
                            {{ adresse.rue }}{% if adresse.complement %}, {{ adresse.complement }}{% endif %}<br>
                            {{ adresse.code_postal }} {{ adresse.ville }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Nombre de pièces :</span>
                    <span class="contrat-value">
                        {% if bien and bien.nombre_pieces_principales %}
                            {{ bien.nombre_pieces_principales }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Appartement/Maison :</span>
                    <span class="contrat-value">
                        {% if bien %}
                            {{ bien.type_bien|title }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                <div class="contrat-row">
                    <span class="contrat-label">Étage :</span>
                    <span class="contrat-value">
                        {% if bien and bien.etage is not None %}
                            {% if bien.etage == 0 %}Rez-de-chaussée{% else %}{{ bien.etage }}{% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <!-- TYPOLOGIE DE LOGEMENT -->
        <div class="typologie-section">
            <h4>Typologie de Logement</h4>
            <p class="typologie-text">
                Logement à usage d'habitation principale et ses dépendances dont la surface est de
                {% if bien and bien.superficie %}{{ bien.superficie }}{% else %}50{% endif %} m² maximum
                (cave, parking et garage).
            </p>
        </div>
    </div>
</div>

<!-- ===== COTISATION ANNUELLE TTC ===== -->
<div class="section-box">
    <div class="section-header">Cotisation Annuelle TTC</div>
    <div class="section-content">
        <div class="cotisation-grid">
            <!-- Colonne gauche : TARIF -->
            <div class="tarif-section">
                <h4>Tarif</h4>
                {% if quotation.selected_formula %}
                <div class="tarif-amount">{{ quotation.selected_formula.pricing_annual }} € TTC</div>
                <div class="tarif-detail">dont garantie assistance de 6,02 € TTC</div>
                <div class="tarif-monthly">soit {{ quotation.selected_formula.pricing_monthly }} € par mois</div>
                {% else %}
                <div class="tarif-amount">- € TTC</div>
                {% endif %}
            </div>

            <!-- Colonne droite : Détails -->
            <div class="cotisation-info">
                <p>Le tarif annuel TTC hors taxe attentat inclut :</p>
                <p>• 85 % de cotisations d'assurance TTC,</p>
                <p>• 15 % de frais de services de Mila Services,</p>
                <p>• xxx € de frais de courtage*</p>
                <p style="margin-top: 12px;">La taxe attentat de 6,50 € est payable annuellement.</p>
            </div>
        </div>
    </div>
</div>

<p class="footer-note">
    *Les frais de courtage sont collectés par Mila Services au nom et pour le compte de votre Distributeur par votre distributeur.
</p>

<!-- ===== PAIEMENT DES COTISATIONS ===== -->
<div class="text-section">
    <h3>Paiement des Cotisations</h3>
    <p>
        Le paiement des cotisations s'effectuera par prélèvement automatique. Vous trouverez en annexe
        votre échéancier comprenant les dates et les montants prélevés pour la première année.
        Le paiement des cotisations s'effectuera par virement.
    </p>
</div>

<!-- ===== GARANTIES ===== -->
<div class="text-section">
    <h3>Garanties</h3>
    <p>
        Le contrat couvre les garanties telles que présentées dans les conditions générales CG-MRH-I-2024061
        valant notice d'information, dans la limite contractuelle de 3 000 000 € par sinistre, tous postes
        de préjudice confondus (dont mobilier).
    </p>
</div>

<!-- ===== TABLEAU DES GARANTIES ===== -->
<table class="table-garanties">
    <thead>
        <tr>
            <th>Garantie</th>
            <th>Essentielle</th>
            <th>Sérénité</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Responsabilité civile locative et privée</td>
            <td class="check">✓</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Dégâts des eaux, gel</td>
            <td class="check">✓</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Incendie, explosion, implosion, enfumage</td>
            <td class="check">✓</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Catastrophes naturelles et technologiques</td>
            <td class="check">✓</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Attentats et actes de terrorisme</td>
            <td class="check">✓</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Événements climatiques</td>
            <td class="check">✓</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Vol et vandalisme</td>
            <td class="cross">✗</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Bris de glace</td>
            <td class="cross">✗</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Dommages électriques</td>
            <td class="cross">✗</td>
            <td class="check">✓</td>
        </tr>
        <tr>
            <td>Assistance 24/7 (serrurerie, vitrerie, électricité)</td>
            <td class="cross">✗</td>
            <td class="check">✓</td>
        </tr>
    </tbody>
</table>

<!-- ===== FRANCHISE ===== -->
<div class="text-section">
    <h3>Franchise</h3>
    <p>
        Une franchise de <strong>{{ quotation.deductible }} €</strong> reste à la charge de l'assuré pour chaque sinistre.
        Cette franchise ne s'applique pas à la garantie Responsabilité Civile.
    </p>
</div>

<!-- ===== DÉCLARATION DE SINISTRE ===== -->
<div class="text-section">
    <h3>Déclaration de Sinistre</h3>
    <p>
        L'assuré doit déclarer tout sinistre dans un délai de 5 jours ouvrés à compter de la date à laquelle
        il en a eu connaissance (2 jours ouvrés en cas de vol). La déclaration peut être effectuée via
        l'espace client Hestia ou par courrier recommandé.
    </p>
</div>

<!-- ===== RÉSILIATION ===== -->
<div class="text-section">
    <h3>Résiliation</h3>
    <p>
        Le contrat peut être résilié à tout moment après la première année d'assurance, avec un préavis d'un mois,
        conformément à la loi Hamon. La résiliation prend effet un mois après réception de la demande.
    </p>
</div>

<!-- ===== SIGNATURES ===== -->
<div class="signature-grid">
    <div class="signature-box">
        <h4>L'Assuré</h4>
        <p style="margin: 0; font-size: 10pt;">
            Fait à ______________, le {{ quotation.effective_date|date:"d/m/Y" }}
        </p>
        <p style="margin: 10px 0 0 0; font-size: 9pt; color: #6c6b70;">
            Signature précédée de la mention "Lu et approuvé"
        </p>
        <!-- Marqueur de signature pour le système générique -->
        {% if locataire %}
        <p style="margin: 15px 0 0 0; font-size: 1pt; color: white;">ID_SIGNATURE_LOC_{{ locataire.id }}</p>
        {% endif %}
    </div>

    <div class="signature-box">
        <h4>Pour l'Assureur</h4>
        <p style="margin: 0; font-size: 10pt;">
            Hestia, courtier en assurances
        </p>
        <p style="margin: 30px 0 0 0; font-size: 9pt; color: #6c6b70;">
            Signature électronique
        </p>
    </div>
</div>

<!-- ===== Footer ===== -->
<div class="footer">
    <p style="margin: 0 0 5px 0; font-size: 9pt;">
        Document généré le {{ "now"|date:"d/m/Y à H:i" }} • Police {{ policy.policy_number }}
    </p>
    <p style="margin: 0; font-size: 8pt;">
        Hestia - Courtier en assurances • Partenaire Mila Assurances
    </p>
</div>
{% endblock %}
